import{E as p,F as ie,h as Le,d as De,b as d,dD as Fe,dE as On,dF as Pn,dG as Et,dH as Rt,bf as Ye,dI as xe,T as Tt,A as Xe,S as R,dJ as G,s as Ze,y as Ue,i as wt,dK as $e,j as Wn,dL as J,V as It,g as y,a as Fn,c as Nn,C as L,f as qn,dM as ne,P as Hn,dN as et,bg as re,dO as Vn,dP as Un,dQ as $n,W as zn,dR as Gn,bc as Kn,dp as Jn,dq as _n,dS as Qn,dt as jn,dT as Yn,dr as Xn,b5 as Ot,dy as Zn,ds as er,dU as tr,dV as nr,dn as rr,k as Pt,b4 as or,u,dW as ir,H as M,dX as sr,J as lr,dY as ar}from"./sanity-9d7a2574.js";import{b as cr,d as hr,a as fr,e as ur}from"./index-df99908f.js";const dr=t=>{let{state:e}=t,r=e.doc.lineAt(e.selection.main.from),n=nt(t.state,r.from);return n.line?mr(t):n.block?pr(t):!1};function tt(t,e){return({state:r,dispatch:n})=>{if(r.readOnly)return!1;let o=t(e,r);return o?(n(r.update(o)),!0):!1}}const mr=tt(kr,0),gr=tt(Wt,0),pr=tt((t,e)=>Wt(t,e,xr(e)),0);function nt(t,e){let r=t.languageDataAt("commentTokens",e);return r.length?r[0]:{}}const te=50;function yr(t,{open:e,close:r},n,o){let i=t.sliceDoc(n-te,n),s=t.sliceDoc(o,o+te),l=/\s*$/.exec(i)[0].length,a=/^\s*/.exec(s)[0].length,c=i.length-l;if(i.slice(c-e.length,c)==e&&s.slice(a,a+r.length)==r)return{open:{pos:n-l,margin:l&&1},close:{pos:o+a,margin:a&&1}};let h,f;o-n<=2*te?h=f=t.sliceDoc(n,o):(h=t.sliceDoc(n,n+te),f=t.sliceDoc(o-te,o));let g=/^\s*/.exec(h)[0].length,x=/\s*$/.exec(f)[0].length,C=f.length-x-r.length;return h.slice(g,g+e.length)==e&&f.slice(C,C+r.length)==r?{open:{pos:n+g+e.length,margin:/\s/.test(h.charAt(g+e.length))?1:0},close:{pos:o-x-r.length,margin:/\s/.test(f.charAt(C-1))?1:0}}:null}function xr(t){let e=[];for(let r of t.selection.ranges){let n=t.doc.lineAt(r.from),o=r.to<=n.to?n:t.doc.lineAt(r.to),i=e.length-1;i>=0&&e[i].to>n.from?e[i].to=o.to:e.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:o.to})}return e}function Wt(t,e,r=e.selection.ranges){let n=r.map(i=>nt(e,i.from).block);if(!n.every(i=>i))return null;let o=r.map((i,s)=>yr(e,n[s],i.from,i.to));if(t!=2&&!o.every(i=>i))return{changes:e.changes(r.map((i,s)=>o[s]?[]:[{from:i.from,insert:n[s].open+" "},{from:i.to,insert:" "+n[s].close}]))};if(t!=1&&o.some(i=>i)){let i=[];for(let s=0,l;s<o.length;s++)if(l=o[s]){let a=n[s],{open:c,close:h}=l;i.push({from:c.pos-a.open.length,to:c.pos+c.margin},{from:h.pos-h.margin,to:h.pos+a.close.length})}return{changes:i}}return null}function kr(t,e,r=e.selection.ranges){let n=[],o=-1;for(let{from:i,to:s}of r){let l=n.length,a=1e9,c=nt(e,i).line;if(c){for(let h=i;h<=s;){let f=e.doc.lineAt(h);if(f.from>o&&(i==s||s>f.from)){o=f.from;let g=/^\s*/.exec(f.text)[0].length,x=g==f.length,C=f.text.slice(g,g+c.length)==c?g:-1;g<f.text.length&&g<a&&(a=g),n.push({line:f,comment:C,token:c,indent:g,empty:x,single:!1})}h=f.to+1}if(a<1e9)for(let h=l;h<n.length;h++)n[h].indent<n[h].line.text.length&&(n[h].indent=a);n.length==l+1&&(n[l].single=!0)}}if(t!=2&&n.some(i=>i.comment<0&&(!i.empty||i.single))){let i=[];for(let{line:l,token:a,indent:c,empty:h,single:f}of n)(f||!h)&&i.push({from:l.from+c,insert:a+" "});let s=e.changes(i);return{changes:s,selection:e.selection.map(s,1)}}else if(t!=1&&n.some(i=>i.comment>=0)){let i=[];for(let{line:s,comment:l,token:a}of n)if(l>=0){let c=s.from+l,h=c+a.length;s.text[h-s.from]==" "&&h++,i.push({from:c,to:h})}return{changes:i}}return null}const ze=Xe.define(),br=Xe.define(),Sr=ie.define(),Ft=ie.define({combine(t){return Le(t,{minDepth:100,newGroupDelay:500,joinToEvent:(e,r)=>r},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,r)=>(n,o)=>e(n,o)||r(n,o)})}});function Cr(t){let e=0;return t.iterChangedRanges((r,n)=>e=n),e}const Nt=De.define({create(){return w.empty},update(t,e){let r=e.state.facet(Ft),n=e.annotation(ze);if(n){let a=e.docChanged?d.single(Cr(e.changes)):void 0,c=S.fromTransaction(e,a),h=n.side,f=h==0?t.undone:t.done;return c?f=ke(f,f.length,r.minDepth,c):f=Vt(f,e.startState.selection),new w(h==0?n.rest:f,h==0?f:n.rest)}let o=e.annotation(br);if((o=="full"||o=="before")&&(t=t.isolate()),e.annotation(Fe.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let i=S.fromTransaction(e),s=e.annotation(Fe.time),l=e.annotation(Fe.userEvent);return i?t=t.addChanges(i,s,l,r,e):e.selection&&(t=t.addSelection(e.startState.selection,s,l,r.newGroupDelay)),(o=="full"||o=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new w(t.done.map(S.fromJSON),t.undone.map(S.fromJSON))}});function Ar(t={}){return[Nt,Ft.of(t),p.domEventHandlers({beforeinput(e,r){let n=e.inputType=="historyUndo"?qt:e.inputType=="historyRedo"?Ge:null;return n?(e.preventDefault(),n(r)):!1}})]}function Be(t,e){return function({state:r,dispatch:n}){if(!e&&r.readOnly)return!1;let o=r.field(Nt,!1);if(!o)return!1;let i=o.pop(t,r,e);return i?(n(i),!0):!1}}const qt=Be(0,!1),Ge=Be(1,!1),vr=Be(0,!0),Mr=Be(1,!0);class S{constructor(e,r,n,o,i){this.changes=e,this.effects=r,this.mapped=n,this.startSelection=o,this.selectionsAfter=i}setSelAfter(e){return new S(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,r,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(r=this.mapped)===null||r===void 0?void 0:r.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(e){return new S(e.changes&&On.fromJSON(e.changes),[],e.mapped&&Pn.fromJSON(e.mapped),e.startSelection&&d.fromJSON(e.startSelection),e.selectionsAfter.map(d.fromJSON))}static fromTransaction(e,r){let n=D;for(let o of e.startState.facet(Sr)){let i=o(e);i.length&&(n=n.concat(i))}return!n.length&&e.changes.empty?null:new S(e.changes.invert(e.startState.doc),n,void 0,r||e.startState.selection,D)}static selection(e){return new S(void 0,D,void 0,void 0,e)}}function ke(t,e,r,n){let o=e+1>r+20?e-r-1:0,i=t.slice(o,e);return i.push(n),i}function Lr(t,e){let r=[],n=!1;return t.iterChangedRanges((o,i)=>r.push(o,i)),e.iterChangedRanges((o,i,s,l)=>{for(let a=0;a<r.length;){let c=r[a++],h=r[a++];l>=c&&s<=h&&(n=!0)}}),n}function Dr(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((r,n)=>r.empty!=e.ranges[n].empty).length===0}function Ht(t,e){return t.length?e.length?t.concat(e):t:e}const D=[],Br=200;function Vt(t,e){if(t.length){let r=t[t.length-1],n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-Br));return n.length&&n[n.length-1].eq(e)?t:(n.push(e),ke(t,t.length-1,1e9,r.setSelAfter(n)))}else return[S.selection([e])]}function Er(t){let e=t[t.length-1],r=t.slice();return r[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),r}function Ne(t,e){if(!t.length)return t;let r=t.length,n=D;for(;r;){let o=Rr(t[r-1],e,n);if(o.changes&&!o.changes.empty||o.effects.length){let i=t.slice(0,r);return i[r-1]=o,i}else e=o.mapped,r--,n=o.selectionsAfter}return n.length?[S.selection(n)]:D}function Rr(t,e,r){let n=Ht(t.selectionsAfter.length?t.selectionsAfter.map(l=>l.map(e)):D,r);if(!t.changes)return S.selection(n);let o=t.changes.map(e),i=e.mapDesc(t.changes,!0),s=t.mapped?t.mapped.composeDesc(i):i;return new S(o,R.mapEffects(t.effects,e),s,t.startSelection.map(i),n)}const Tr=/^(input\.type|delete)($|\.)/;class w{constructor(e,r,n=0,o=void 0){this.done=e,this.undone=r,this.prevTime=n,this.prevUserEvent=o}isolate(){return this.prevTime?new w(this.done,this.undone):this}addChanges(e,r,n,o,i){let s=this.done,l=s[s.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!n||Tr.test(n))&&(!l.selectionsAfter.length&&r-this.prevTime<o.newGroupDelay&&o.joinToEvent(i,Lr(l.changes,e.changes))||n=="input.type.compose")?s=ke(s,s.length-1,o.minDepth,new S(e.changes.compose(l.changes),Ht(e.effects,l.effects),l.mapped,l.startSelection,D)):s=ke(s,s.length,o.minDepth,e),new w(s,D,r,n)}addSelection(e,r,n,o){let i=this.done.length?this.done[this.done.length-1].selectionsAfter:D;return i.length>0&&r-this.prevTime<o&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Dr(i[i.length-1],e)?this:new w(Vt(this.done,e),this.undone,r,n)}addMapping(e){return new w(Ne(this.done,e),Ne(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,r,n){let o=e==0?this.done:this.undone;if(o.length==0)return null;let i=o[o.length-1];if(n&&i.selectionsAfter.length)return r.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:ze.of({side:e,rest:Er(o)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(i.changes){let s=o.length==1?D:o.slice(0,o.length-1);return i.mapped&&(s=Ne(s,i.mapped)),r.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:ze.of({side:e,rest:s}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}w.empty=new w(D,D);const wr=[{key:"Mod-z",run:qt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Ge,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Ge,preventDefault:!0},{key:"Mod-u",run:vr,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Mr,preventDefault:!0}];function j(t,e){return d.create(t.ranges.map(e),t.mainIndex)}function I(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function T({state:t,dispatch:e},r){let n=j(t.selection,r);return n.eq(t.selection)?!1:(e(I(t,n)),!0)}function Ee(t,e){return d.cursor(e?t.to:t.from)}function Ut(t,e){return T(t,r=>r.empty?t.moveByChar(r,e):Ee(r,e))}function b(t){return t.textDirectionAt(t.state.selection.main.head)==Wn.LTR}const $t=t=>Ut(t,!b(t)),zt=t=>Ut(t,b(t));function Gt(t,e){return T(t,r=>r.empty?t.moveByGroup(r,e):Ee(r,e))}const Ir=t=>Gt(t,!b(t)),Or=t=>Gt(t,b(t));function Pr(t,e,r){if(e.type.prop(r))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function Re(t,e,r){let n=Ze(t).resolveInner(e.head),o=r?Ue.closedBy:Ue.openedBy;for(let a=e.head;;){let c=r?n.childAfter(a):n.childBefore(a);if(!c)break;Pr(t,c,o)?n=c:a=r?c.to:c.from}let i=n.type.prop(o),s,l;return i&&(s=r?G(t,n.from,1):G(t,n.to,-1))&&s.matched?l=r?s.end.to:s.end.from:l=r?n.to:n.from,d.cursor(l,r?-1:1)}const Wr=t=>T(t,e=>Re(t.state,e,!b(t))),Fr=t=>T(t,e=>Re(t.state,e,b(t)));function Kt(t,e){return T(t,r=>{if(!r.empty)return Ee(r,e);let n=t.moveVertically(r,e);return n.head!=r.head?n:t.moveToLineBoundary(r,e)})}const Jt=t=>Kt(t,!1),_t=t=>Kt(t,!0);function Qt(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,r=0,n=0,o;if(e){for(let i of t.state.facet(p.scrollMargins)){let s=i(t);s!=null&&s.top&&(r=Math.max(s==null?void 0:s.top,r)),s!=null&&s.bottom&&(n=Math.max(s==null?void 0:s.bottom,n))}o=t.scrollDOM.clientHeight-r-n}else o=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:r,marginBottom:n,selfScroll:e,height:Math.max(t.defaultLineHeight,o-5)}}function jt(t,e){let r=Qt(t),{state:n}=t,o=j(n.selection,s=>s.empty?t.moveVertically(s,e,r.height):Ee(s,e));if(o.eq(n.selection))return!1;let i;if(r.selfScroll){let s=t.coordsAtPos(n.selection.main.head),l=t.scrollDOM.getBoundingClientRect(),a=l.top+r.marginTop,c=l.bottom-r.marginBottom;s&&s.top>a&&s.bottom<c&&(i=p.scrollIntoView(o.main.head,{y:"start",yMargin:s.top-a}))}return t.dispatch(I(n,o),{effects:i}),!0}const ct=t=>jt(t,!1),Ke=t=>jt(t,!0);function F(t,e,r){let n=t.lineBlockAt(e.head),o=t.moveToLineBoundary(e,r);if(o.head==e.head&&o.head!=(r?n.to:n.from)&&(o=t.moveToLineBoundary(e,r,!1)),!r&&o.head==n.from&&n.length){let i=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&e.head!=n.from+i&&(o=d.cursor(n.from+i))}return o}const Nr=t=>T(t,e=>F(t,e,!0)),qr=t=>T(t,e=>F(t,e,!1)),Hr=t=>T(t,e=>F(t,e,!b(t))),Vr=t=>T(t,e=>F(t,e,b(t))),Ur=t=>T(t,e=>d.cursor(t.lineBlockAt(e.head).from,1)),$r=t=>T(t,e=>d.cursor(t.lineBlockAt(e.head).to,-1));function zr(t,e,r){let n=!1,o=j(t.selection,i=>{let s=G(t,i.head,-1)||G(t,i.head,1)||i.head>0&&G(t,i.head-1,1)||i.head<t.doc.length&&G(t,i.head+1,-1);if(!s||!s.end)return i;n=!0;let l=s.start.from==i.head?s.end.to:s.end.from;return r?d.range(i.anchor,l):d.cursor(l)});return n?(e(I(t,o)),!0):!1}const Gr=({state:t,dispatch:e})=>zr(t,e,!1);function B(t,e){let r=j(t.state.selection,n=>{let o=e(n);return d.range(n.anchor,o.head,o.goalColumn,o.bidiLevel||void 0)});return r.eq(t.state.selection)?!1:(t.dispatch(I(t.state,r)),!0)}function Yt(t,e){return B(t,r=>t.moveByChar(r,e))}const Xt=t=>Yt(t,!b(t)),Zt=t=>Yt(t,b(t));function en(t,e){return B(t,r=>t.moveByGroup(r,e))}const Kr=t=>en(t,!b(t)),Jr=t=>en(t,b(t)),_r=t=>B(t,e=>Re(t.state,e,!b(t))),Qr=t=>B(t,e=>Re(t.state,e,b(t)));function tn(t,e){return B(t,r=>t.moveVertically(r,e))}const nn=t=>tn(t,!1),rn=t=>tn(t,!0);function on(t,e){return B(t,r=>t.moveVertically(r,e,Qt(t).height))}const ht=t=>on(t,!1),ft=t=>on(t,!0),jr=t=>B(t,e=>F(t,e,!0)),Yr=t=>B(t,e=>F(t,e,!1)),Xr=t=>B(t,e=>F(t,e,!b(t))),Zr=t=>B(t,e=>F(t,e,b(t))),eo=t=>B(t,e=>d.cursor(t.lineBlockAt(e.head).from)),to=t=>B(t,e=>d.cursor(t.lineBlockAt(e.head).to)),ut=({state:t,dispatch:e})=>(e(I(t,{anchor:0})),!0),dt=({state:t,dispatch:e})=>(e(I(t,{anchor:t.doc.length})),!0),mt=({state:t,dispatch:e})=>(e(I(t,{anchor:t.selection.main.anchor,head:0})),!0),gt=({state:t,dispatch:e})=>(e(I(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),no=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),ro=({state:t,dispatch:e})=>{let r=we(t).map(({from:n,to:o})=>d.range(n,Math.min(o+1,t.doc.length)));return e(t.update({selection:d.create(r),userEvent:"select"})),!0},oo=({state:t,dispatch:e})=>{let r=j(t.selection,n=>{var o;let i=Ze(t).resolveInner(n.head,1);for(;!(i.from<n.from&&i.to>=n.to||i.to>n.to&&i.from<=n.from||!(!((o=i.parent)===null||o===void 0)&&o.parent));)i=i.parent;return d.range(i.to,i.from)});return e(I(t,r)),!0},io=({state:t,dispatch:e})=>{let r=t.selection,n=null;return r.ranges.length>1?n=d.create([r.main]):r.main.empty||(n=d.create([d.cursor(r.main.head)])),n?(e(I(t,n)),!0):!1};function Te(t,e){if(t.state.readOnly)return!1;let r="delete.selection",{state:n}=t,o=n.changeByRange(i=>{let{from:s,to:l}=i;if(s==l){let a=e(s);a<s?(r="delete.backward",a=de(t,a,!1)):a>s&&(r="delete.forward",a=de(t,a,!0)),s=Math.min(s,a),l=Math.max(l,a)}else s=de(t,s,!1),l=de(t,l,!0);return s==l?{range:i}:{changes:{from:s,to:l},range:d.cursor(s)}});return o.changes.empty?!1:(t.dispatch(n.update(o,{scrollIntoView:!0,userEvent:r,effects:r=="delete.selection"?p.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function de(t,e,r){if(t instanceof p)for(let n of t.state.facet(p.atomicRanges).map(o=>o(t)))n.between(e,e,(o,i)=>{o<e&&i>e&&(e=r?i:o)});return e}const sn=(t,e)=>Te(t,r=>{let{state:n}=t,o=n.doc.lineAt(r),i,s;if(!e&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(i=o.text.slice(0,r-o.from))){if(i[i.length-1]=="	")return r-1;let l=Ye(i,n.tabSize),a=l%$e(n)||$e(n);for(let c=0;c<a&&i[i.length-1-c]==" ";c++)r--;s=r}else s=J(o.text,r-o.from,e,e)+o.from,s==r&&o.number!=(e?n.doc.lines:1)&&(s+=e?1:-1);return s}),Je=t=>sn(t,!1),ln=t=>sn(t,!0),an=(t,e)=>Te(t,r=>{let n=r,{state:o}=t,i=o.doc.lineAt(n),s=o.charCategorizer(n);for(let l=null;;){if(n==(e?i.to:i.from)){n==r&&i.number!=(e?o.doc.lines:1)&&(n+=e?1:-1);break}let a=J(i.text,n-i.from,e)+i.from,c=i.text.slice(Math.min(n,a)-i.from,Math.max(n,a)-i.from),h=s(c);if(l!=null&&h!=l)break;(c!=" "||n!=r)&&(l=h),n=a}return n}),cn=t=>an(t,!1),so=t=>an(t,!0),hn=t=>Te(t,e=>{let r=t.lineBlockAt(e).to;return e<r?r:Math.min(t.state.doc.length,e+1)}),lo=t=>Te(t,e=>{let r=t.lineBlockAt(e).from;return e>r?r:Math.max(0,e-1)}),ao=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:Tt.of(["",""])},range:d.cursor(n.from)}));return e(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0},co=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>{if(!n.empty||n.from==0||n.from==t.doc.length)return{range:n};let o=n.from,i=t.doc.lineAt(o),s=o==i.from?o-1:J(i.text,o-i.from,!1)+i.from,l=o==i.to?o+1:J(i.text,o-i.from,!0)+i.from;return{changes:{from:s,to:l,insert:t.doc.slice(o,l).append(t.doc.slice(s,o))},range:d.cursor(l)}});return r.changes.empty?!1:(e(t.update(r,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function we(t){let e=[],r=-1;for(let n of t.selection.ranges){let o=t.doc.lineAt(n.from),i=t.doc.lineAt(n.to);if(!n.empty&&n.to==i.from&&(i=t.doc.lineAt(n.to-1)),r>=o.number){let s=e[e.length-1];s.to=i.to,s.ranges.push(n)}else e.push({from:o.from,to:i.to,ranges:[n]});r=i.number+1}return e}function fn(t,e,r){if(t.readOnly)return!1;let n=[],o=[];for(let i of we(t)){if(r?i.to==t.doc.length:i.from==0)continue;let s=t.doc.lineAt(r?i.to+1:i.from-1),l=s.length+1;if(r){n.push({from:i.to,to:s.to},{from:i.from,insert:s.text+t.lineBreak});for(let a of i.ranges)o.push(d.range(Math.min(t.doc.length,a.anchor+l),Math.min(t.doc.length,a.head+l)))}else{n.push({from:s.from,to:i.from},{from:i.to,insert:t.lineBreak+s.text});for(let a of i.ranges)o.push(d.range(a.anchor-l,a.head-l))}}return n.length?(e(t.update({changes:n,scrollIntoView:!0,selection:d.create(o,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}const ho=({state:t,dispatch:e})=>fn(t,e,!1),fo=({state:t,dispatch:e})=>fn(t,e,!0);function un(t,e,r){if(t.readOnly)return!1;let n=[];for(let o of we(t))r?n.push({from:o.from,insert:t.doc.slice(o.from,o.to)+t.lineBreak}):n.push({from:o.to,insert:t.lineBreak+t.doc.slice(o.from,o.to)});return e(t.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const uo=({state:t,dispatch:e})=>un(t,e,!1),mo=({state:t,dispatch:e})=>un(t,e,!0),go=t=>{if(t.state.readOnly)return!1;let{state:e}=t,r=e.changes(we(e).map(({from:o,to:i})=>(o>0?o--:i<e.doc.length&&i++,{from:o,to:i}))),n=j(e.selection,o=>t.moveVertically(o,!0)).map(r);return t.dispatch({changes:r,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function po(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let r=Ze(t).resolveInner(e),n=r.childBefore(e),o=r.childAfter(e),i;return n&&o&&n.to<=e&&o.from>=e&&(i=n.type.prop(Ue.closedBy))&&i.indexOf(o.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(o.from).from&&!/\S/.test(t.sliceDoc(n.to,o.from))?{from:n.to,to:o.from}:null}const yo=dn(!1),xo=dn(!0);function dn(t){return({state:e,dispatch:r})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>{let{from:i,to:s}=o,l=e.doc.lineAt(i),a=!t&&i==s&&po(e,i);t&&(i=s=(s<=l.to?l:e.doc.lineAt(s)).to);let c=new Et(e,{simulateBreak:i,simulateDoubleBreak:!!a}),h=Rt(c,i);for(h==null&&(h=Ye(/^\s*/.exec(e.doc.lineAt(i).text)[0],e.tabSize));s<l.to&&/\s/.test(l.text[s-l.from]);)s++;a?{from:i,to:s}=a:i>l.from&&i<l.from+100&&!/\S/.test(l.text.slice(0,i))&&(i=l.from);let f=["",xe(e,h)];return a&&f.push(xe(e,c.lineIndent(l.from,-1))),{changes:{from:i,to:s,insert:Tt.of(f)},range:d.cursor(i+1+f[1].length)}});return r(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function rt(t,e){let r=-1;return t.changeByRange(n=>{let o=[];for(let s=n.from;s<=n.to;){let l=t.doc.lineAt(s);l.number>r&&(n.empty||n.to>l.from)&&(e(l,o,n),r=l.number),s=l.to+1}let i=t.changes(o);return{changes:o,range:d.range(i.mapPos(n.anchor,1),i.mapPos(n.head,1))}})}const ko=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=Object.create(null),n=new Et(t,{overrideIndentation:i=>{let s=r[i];return s??-1}}),o=rt(t,(i,s,l)=>{let a=Rt(n,i.from);if(a==null)return;/\S/.test(i.text)||(a=0);let c=/^\s*/.exec(i.text)[0],h=xe(t,a);(c!=h||l.from<i.from+c.length)&&(r[i.from]=a,s.push({from:i.from,to:i.from+c.length,insert:h}))});return o.changes.empty||e(t.update(o,{userEvent:"indent"})),!0},mn=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(rt(t,(r,n)=>{n.push({from:r.from,insert:t.facet(wt)})}),{userEvent:"input.indent"})),!0),gn=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(rt(t,(r,n)=>{let o=/^\s*/.exec(r.text)[0];if(!o)return;let i=Ye(o,t.tabSize),s=0,l=xe(t,Math.max(0,i-$e(t)));for(;s<o.length&&s<l.length&&o.charCodeAt(s)==l.charCodeAt(s);)s++;n.push({from:r.from+s,to:r.from+o.length,insert:l.slice(s)})}),{userEvent:"delete.dedent"})),!0),bo=[{key:"Ctrl-b",run:$t,shift:Xt,preventDefault:!0},{key:"Ctrl-f",run:zt,shift:Zt},{key:"Ctrl-p",run:Jt,shift:nn},{key:"Ctrl-n",run:_t,shift:rn},{key:"Ctrl-a",run:Ur,shift:eo},{key:"Ctrl-e",run:$r,shift:to},{key:"Ctrl-d",run:ln},{key:"Ctrl-h",run:Je},{key:"Ctrl-k",run:hn},{key:"Ctrl-Alt-h",run:cn},{key:"Ctrl-o",run:ao},{key:"Ctrl-t",run:co},{key:"Ctrl-v",run:Ke}],So=[{key:"ArrowLeft",run:$t,shift:Xt,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Ir,shift:Kr,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Hr,shift:Xr,preventDefault:!0},{key:"ArrowRight",run:zt,shift:Zt,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Or,shift:Jr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Vr,shift:Zr,preventDefault:!0},{key:"ArrowUp",run:Jt,shift:nn,preventDefault:!0},{mac:"Cmd-ArrowUp",run:ut,shift:mt},{mac:"Ctrl-ArrowUp",run:ct,shift:ht},{key:"ArrowDown",run:_t,shift:rn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:dt,shift:gt},{mac:"Ctrl-ArrowDown",run:Ke,shift:ft},{key:"PageUp",run:ct,shift:ht},{key:"PageDown",run:Ke,shift:ft},{key:"Home",run:qr,shift:Yr,preventDefault:!0},{key:"Mod-Home",run:ut,shift:mt},{key:"End",run:Nr,shift:jr,preventDefault:!0},{key:"Mod-End",run:dt,shift:gt},{key:"Enter",run:yo},{key:"Mod-a",run:no},{key:"Backspace",run:Je,shift:Je},{key:"Delete",run:ln},{key:"Mod-Backspace",mac:"Alt-Backspace",run:cn},{key:"Mod-Delete",mac:"Alt-Delete",run:so},{mac:"Mod-Backspace",run:lo},{mac:"Mod-Delete",run:hn}].concat(bo.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),Co=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Wr,shift:_r},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Fr,shift:Qr},{key:"Alt-ArrowUp",run:ho},{key:"Shift-Alt-ArrowUp",run:uo},{key:"Alt-ArrowDown",run:fo},{key:"Shift-Alt-ArrowDown",run:mo},{key:"Escape",run:io},{key:"Mod-Enter",run:xo},{key:"Alt-l",mac:"Ctrl-l",run:ro},{key:"Mod-i",run:oo,preventDefault:!0},{key:"Mod-[",run:gn},{key:"Mod-]",run:mn},{key:"Mod-Alt-\\",run:ko},{key:"Shift-Mod-k",run:go},{key:"Shift-Mod-\\",run:Gr},{key:"Mod-/",run:dr},{key:"Alt-A",run:gr}].concat(So),Ao={key:"Tab",run:mn,shift:gn};function m(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var o=r[n];typeof o=="string"?t.setAttribute(n,o):o!=null&&(t[n]=o)}e++}for(;e<arguments.length;e++)pn(t,arguments[e]);return t}function pn(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var r=0;r<e.length;r++)pn(t,e[r]);else throw new RangeError("Unsupported child node: "+e)}const pt=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class _{constructor(e,r,n=0,o=e.length,i,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,o),this.bufferStart=n,this.normalize=i?l=>i(pt(l)):pt,this.query=this.normalize(r)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Fn(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let r=qn(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=Nn(e);let o=this.normalize(r);for(let i=0,s=n;;i++){let l=o.charCodeAt(i),a=this.match(l,s);if(i==o.length-1){if(a)return this.value=a,this;break}s==n&&i<r.length&&r.charCodeAt(i)==l&&s++}}}match(e,r){let n=null;for(let o=0;o<this.matches.length;o+=2){let i=this.matches[o],s=!1;this.query.charCodeAt(i)==e&&(i==this.query.length-1?n={from:this.matches[o+1],to:r+1}:(this.matches[o]++,s=!0)),s||(this.matches.splice(o,2),o-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:r,to:r+1}:this.matches.push(1,r)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}typeof Symbol<"u"&&(_.prototype[Symbol.iterator]=function(){return this});const yn={from:-1,to:-1,match:/.*/.exec("")},ot="gm"+(/x/.unicode==null?"":"u");class xn{constructor(e,r,n,o=0,i=e.length){if(this.text=e,this.to=i,this.curLine="",this.done=!1,this.value=yn,/\\[sWDnr]|\n|\r|\[\^/.test(r))return new kn(e,r,n,o,i);this.re=new RegExp(r,ot+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=e.iter();let s=e.lineAt(o);this.curLineStart=s.from,this.matchPos=be(e,o),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let r=this.matchPos<=this.to&&this.re.exec(this.curLine);if(r){let n=this.curLineStart+r.index,o=n+r[0].length;if(this.matchPos=be(this.text,o+(n==o?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<o||n>this.value.to)&&(!this.test||this.test(n,o,r)))return this.value={from:n,to:o,match:r},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const qe=new WeakMap;class K{constructor(e,r){this.from=e,this.text=r}get to(){return this.from+this.text.length}static get(e,r,n){let o=qe.get(e);if(!o||o.from>=n||o.to<=r){let l=new K(r,e.sliceString(r,n));return qe.set(e,l),l}if(o.from==r&&o.to==n)return o;let{text:i,from:s}=o;return s>r&&(i=e.sliceString(r,s)+i,s=r),o.to<n&&(i+=e.sliceString(o.to,n)),qe.set(e,new K(s,i)),new K(r,i.slice(r-s,n-s))}}class kn{constructor(e,r,n,o,i){this.text=e,this.to=i,this.done=!1,this.value=yn,this.matchPos=be(e,o),this.re=new RegExp(r,ot+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=K.get(e,o,this.chunkEnd(o+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,r=this.re.exec(this.flat.text);if(r&&!r[0]&&r.index==e&&(this.re.lastIndex=e+1,r=this.re.exec(this.flat.text)),r){let n=this.flat.from+r.index,o=n+r[0].length;if((this.flat.to>=this.to||r.index+r[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,o,r)))return this.value={from:n,to:o,match:r},this.matchPos=be(this.text,o+(n==o?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=K.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(xn.prototype[Symbol.iterator]=kn.prototype[Symbol.iterator]=function(){return this});function vo(t){try{return new RegExp(t,ot),!0}catch{return!1}}function be(t,e){if(e>=t.length)return e;let r=t.lineAt(e),n;for(;e<r.to&&(n=r.text.charCodeAt(e-r.from))>=56320&&n<57344;)e++;return e}function _e(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),r=m("input",{class:"cm-textfield",name:"line",value:e}),n=m("form",{class:"cm-gotoLine",onkeydown:i=>{i.keyCode==27?(i.preventDefault(),t.dispatch({effects:Se.of(!1)}),t.focus()):i.keyCode==13&&(i.preventDefault(),o())},onsubmit:i=>{i.preventDefault(),o()}},m("label",t.state.phrase("Go to line"),": ",r)," ",m("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function o(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(r.value);if(!i)return;let{state:s}=t,l=s.doc.lineAt(s.selection.main.head),[,a,c,h,f]=i,g=h?+h.slice(1):0,x=c?+c:l.number;if(c&&f){let P=x/100;a&&(P=P*(a=="-"?-1:1)+l.number/s.doc.lines),x=Math.round(s.doc.lines*P)}else c&&a&&(x=x*(a=="-"?-1:1)+l.number);let C=s.doc.line(Math.max(1,Math.min(s.doc.lines,x))),N=d.cursor(C.from+Math.max(0,Math.min(g,C.length)));t.dispatch({effects:[Se.of(!1),p.scrollIntoView(N.from,{y:"center"})],selection:N}),t.focus()}return{dom:n}}const Se=R.define(),yt=De.define({create(){return!0},update(t,e){for(let r of e.effects)r.is(Se)&&(t=r.value);return t},provide:t=>et.from(t,e=>e?_e:null)}),Mo=t=>{let e=ne(t,_e);if(!e){let r=[Se.of(!0)];t.state.field(yt,!1)==null&&r.push(R.appendConfig.of([yt,Lo])),t.dispatch({effects:r}),e=ne(t,_e)}return e&&e.dom.querySelector("input").select(),!0},Lo=p.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Do={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},bn=ie.define({combine(t){return Le(t,Do,{highlightWordAroundCursor:(e,r)=>e||r,minSelectionLength:Math.min,maxMatches:Math.min})}});function Bo(t){let e=[Io,wo];return t&&e.push(bn.of(t)),e}const Eo=y.mark({class:"cm-selectionMatch"}),Ro=y.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function xt(t,e,r,n){return(r==0||t(e.sliceDoc(r-1,r))!=L.Word)&&(n==e.doc.length||t(e.sliceDoc(n,n+1))!=L.Word)}function To(t,e,r,n){return t(e.sliceDoc(r,r+1))==L.Word&&t(e.sliceDoc(n-1,n))==L.Word}const wo=It.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(bn),{state:r}=t,n=r.selection;if(n.ranges.length>1)return y.none;let o=n.main,i,s=null;if(o.empty){if(!e.highlightWordAroundCursor)return y.none;let a=r.wordAt(o.head);if(!a)return y.none;s=r.charCategorizer(o.head),i=r.sliceDoc(a.from,a.to)}else{let a=o.to-o.from;if(a<e.minSelectionLength||a>200)return y.none;if(e.wholeWords){if(i=r.sliceDoc(o.from,o.to),s=r.charCategorizer(o.head),!(xt(s,r,o.from,o.to)&&To(s,r,o.from,o.to)))return y.none}else if(i=r.sliceDoc(o.from,o.to).trim(),!i)return y.none}let l=[];for(let a of t.visibleRanges){let c=new _(r.doc,i,a.from,a.to);for(;!c.next().done;){let{from:h,to:f}=c.value;if((!s||xt(s,r,h,f))&&(o.empty&&h<=o.from&&f>=o.to?l.push(Ro.range(h,f)):(h>=o.to||f<=o.from)&&l.push(Eo.range(h,f)),l.length>e.maxMatches))return y.none}}return y.set(l)}},{decorations:t=>t.decorations}),Io=p.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Oo=({state:t,dispatch:e})=>{let{selection:r}=t,n=d.create(r.ranges.map(o=>t.wordAt(o.head)||d.cursor(o.head)),r.mainIndex);return n.eq(r)?!1:(e(t.update({selection:n})),!0)};function Po(t,e){let{main:r,ranges:n}=t.selection,o=t.wordAt(r.head),i=o&&o.from==r.from&&o.to==r.to;for(let s=!1,l=new _(t.doc,e,n[n.length-1].to);;)if(l.next(),l.done){if(s)return null;l=new _(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),s=!0}else{if(s&&n.some(a=>a.from==l.value.from))continue;if(i){let a=t.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const Wo=({state:t,dispatch:e})=>{let{ranges:r}=t.selection;if(r.some(i=>i.from===i.to))return Oo({state:t,dispatch:e});let n=t.sliceDoc(r[0].from,r[0].to);if(t.selection.ranges.some(i=>t.sliceDoc(i.from,i.to)!=n))return!1;let o=Po(t,n);return o?(e(t.update({selection:t.selection.addRange(d.range(o.from,o.to),!1),effects:p.scrollIntoView(o.to)})),!0):!1},Y=ie.define({combine(t){return Le(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new _o(e),scrollToMatch:e=>p.scrollIntoView(e)})}});class Sn{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||vo(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(r,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Ho(this):new No(this)}getCursor(e,r=0,n){let o=e.doc?e:re.create({doc:e});return n==null&&(n=o.doc.length),this.regexp?z(this,o,r,n):$(this,o,r,n)}}class Cn{constructor(e){this.spec=e}}function $(t,e,r,n){return new _(e.doc,t.unquoted,r,n,t.caseSensitive?void 0:o=>o.toLowerCase(),t.wholeWord?Fo(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Fo(t,e){return(r,n,o,i)=>((i>r||i+o.length<n)&&(i=Math.max(0,r-2),o=t.sliceString(i,Math.min(t.length,n+2))),(e(Ce(o,r-i))!=L.Word||e(Ae(o,r-i))!=L.Word)&&(e(Ae(o,n-i))!=L.Word||e(Ce(o,n-i))!=L.Word))}class No extends Cn{constructor(e){super(e)}nextMatch(e,r,n){let o=$(this.spec,e,n,e.doc.length).nextOverlapping();return o.done&&(o=$(this.spec,e,0,r).nextOverlapping()),o.done?null:o.value}prevMatchInRange(e,r,n){for(let o=n;;){let i=Math.max(r,o-1e4-this.spec.unquoted.length),s=$(this.spec,e,i,o),l=null;for(;!s.nextOverlapping().done;)l=s.value;if(l)return l;if(i==r)return null;o-=1e4}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,r){let n=$(this.spec,e,0,e.doc.length),o=[];for(;!n.next().done;){if(o.length>=r)return null;o.push(n.value)}return o}highlight(e,r,n,o){let i=$(this.spec,e,Math.max(0,r-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!i.next().done;)o(i.value.from,i.value.to)}}function z(t,e,r,n){return new xn(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?qo(e.charCategorizer(e.selection.main.head)):void 0},r,n)}function Ce(t,e){return t.slice(J(t,e,!1),e)}function Ae(t,e){return t.slice(e,J(t,e))}function qo(t){return(e,r,n)=>!n[0].length||(t(Ce(n.input,n.index))!=L.Word||t(Ae(n.input,n.index))!=L.Word)&&(t(Ae(n.input,n.index+n[0].length))!=L.Word||t(Ce(n.input,n.index+n[0].length))!=L.Word)}class Ho extends Cn{nextMatch(e,r,n){let o=z(this.spec,e,n,e.doc.length).next();return o.done&&(o=z(this.spec,e,0,r).next()),o.done?null:o.value}prevMatchInRange(e,r,n){for(let o=1;;o++){let i=Math.max(r,n-o*1e4),s=z(this.spec,e,i,n),l=null;for(;!s.next().done;)l=s.value;if(l&&(i==r||l.from>i+10))return l;if(i==r)return null}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(r,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:r))}matchAll(e,r){let n=z(this.spec,e,0,e.doc.length),o=[];for(;!n.next().done;){if(o.length>=r)return null;o.push(n.value)}return o}highlight(e,r,n,o){let i=z(this.spec,e,Math.max(0,r-250),Math.min(n+250,e.doc.length));for(;!i.next().done;)o(i.value.from,i.value.to)}}const oe=R.define(),it=R.define(),W=De.define({create(t){return new He(Qe(t).create(),null)},update(t,e){for(let r of e.effects)r.is(oe)?t=new He(r.value.create(),t.panel):r.is(it)&&(t=new He(t.query,r.value?st:null));return t},provide:t=>et.from(t,e=>e.panel)});class He{constructor(e,r){this.query=e,this.panel=r}}const Vo=y.mark({class:"cm-searchMatch"}),Uo=y.mark({class:"cm-searchMatch cm-searchMatch-selected"}),$o=It.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(W))}update(t){let e=t.state.field(W);(e!=t.startState.field(W)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return y.none;let{view:r}=this,n=new Vn;for(let o=0,i=r.visibleRanges,s=i.length;o<s;o++){let{from:l,to:a}=i[o];for(;o<s-1&&a>i[o+1].from-2*250;)a=i[++o].to;t.highlight(r.state,l,a,(c,h)=>{let f=r.state.selection.ranges.some(g=>g.from==c&&g.to==h);n.add(c,h,f?Uo:Vo)})}return n.finish()}},{decorations:t=>t.decorations});function se(t){return e=>{let r=e.state.field(W,!1);return r&&r.query.spec.valid?t(e,r):Mn(e)}}const ve=se((t,{query:e})=>{let{to:r}=t.state.selection.main,n=e.nextMatch(t.state,r,r);if(!n)return!1;let o=d.single(n.from,n.to),i=t.state.facet(Y);return t.dispatch({selection:o,effects:[lt(t,n),i.scrollToMatch(o.main,t)],userEvent:"select.search"}),vn(t),!0}),Me=se((t,{query:e})=>{let{state:r}=t,{from:n}=r.selection.main,o=e.prevMatch(r,n,n);if(!o)return!1;let i=d.single(o.from,o.to),s=t.state.facet(Y);return t.dispatch({selection:i,effects:[lt(t,o),s.scrollToMatch(i.main,t)],userEvent:"select.search"}),vn(t),!0}),zo=se((t,{query:e})=>{let r=e.matchAll(t.state,1e3);return!r||!r.length?!1:(t.dispatch({selection:d.create(r.map(n=>d.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),Go=({state:t,dispatch:e})=>{let r=t.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:n,to:o}=r.main,i=[],s=0;for(let l=new _(t.doc,t.sliceDoc(n,o));!l.next().done;){if(i.length>1e3)return!1;l.value.from==n&&(s=i.length),i.push(d.range(l.value.from,l.value.to))}return e(t.update({selection:d.create(i,s),userEvent:"select.search.matches"})),!0},kt=se((t,{query:e})=>{let{state:r}=t,{from:n,to:o}=r.selection.main;if(r.readOnly)return!1;let i=e.nextMatch(r,n,n);if(!i)return!1;let s=[],l,a,c=[];if(i.from==n&&i.to==o&&(a=r.toText(e.getReplacement(i)),s.push({from:i.from,to:i.to,insert:a}),i=e.nextMatch(r,i.from,i.to),c.push(p.announce.of(r.phrase("replaced match on line $",r.doc.lineAt(n).number)+"."))),i){let h=s.length==0||s[0].from>=i.to?0:i.to-i.from-a.length;l=d.single(i.from-h,i.to-h),c.push(lt(t,i)),c.push(r.facet(Y).scrollToMatch(l.main,t))}return t.dispatch({changes:s,selection:l,effects:c,userEvent:"input.replace"}),!0}),Ko=se((t,{query:e})=>{if(t.state.readOnly)return!1;let r=e.matchAll(t.state,1e9).map(o=>{let{from:i,to:s}=o;return{from:i,to:s,insert:e.getReplacement(o)}});if(!r.length)return!1;let n=t.state.phrase("replaced $ matches",r.length)+".";return t.dispatch({changes:r,effects:p.announce.of(n),userEvent:"input.replace.all"}),!0});function st(t){return t.state.facet(Y).createPanel(t)}function Qe(t,e){var r,n,o,i,s;let l=t.selection.main,a=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!a)return e;let c=t.facet(Y);return new Sn({search:((r=e==null?void 0:e.literal)!==null&&r!==void 0?r:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(n=e==null?void 0:e.caseSensitive)!==null&&n!==void 0?n:c.caseSensitive,literal:(o=e==null?void 0:e.literal)!==null&&o!==void 0?o:c.literal,regexp:(i=e==null?void 0:e.regexp)!==null&&i!==void 0?i:c.regexp,wholeWord:(s=e==null?void 0:e.wholeWord)!==null&&s!==void 0?s:c.wholeWord})}function An(t){let e=ne(t,st);return e&&e.dom.querySelector("[main-field]")}function vn(t){let e=An(t);e&&e==t.root.activeElement&&e.select()}const Mn=t=>{let e=t.state.field(W,!1);if(e&&e.panel){let r=An(t);if(r&&r!=t.root.activeElement){let n=Qe(t.state,e.query.spec);n.valid&&t.dispatch({effects:oe.of(n)}),r.focus(),r.select()}}else t.dispatch({effects:[it.of(!0),e?oe.of(Qe(t.state,e.query.spec)):R.appendConfig.of(jo)]});return!0},Ln=t=>{let e=t.state.field(W,!1);if(!e||!e.panel)return!1;let r=ne(t,st);return r&&r.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:it.of(!1)}),!0},Jo=[{key:"Mod-f",run:Mn,scope:"editor search-panel"},{key:"F3",run:ve,shift:Me,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:ve,shift:Me,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Ln,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Go},{key:"Alt-g",run:Mo},{key:"Mod-d",run:Wo,preventDefault:!0}];class _o{constructor(e){this.view=e;let r=this.query=e.state.field(W).query.spec;this.commit=this.commit.bind(this),this.searchField=m("input",{value:r.search,placeholder:A(e,"Find"),"aria-label":A(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=m("input",{value:r.replace,placeholder:A(e,"Replace"),"aria-label":A(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=m("input",{type:"checkbox",name:"case",form:"",checked:r.caseSensitive,onchange:this.commit}),this.reField=m("input",{type:"checkbox",name:"re",form:"",checked:r.regexp,onchange:this.commit}),this.wordField=m("input",{type:"checkbox",name:"word",form:"",checked:r.wholeWord,onchange:this.commit});function n(o,i,s){return m("button",{class:"cm-button",name:o,onclick:i,type:"button"},s)}this.dom=m("div",{onkeydown:o=>this.keydown(o),class:"cm-search"},[this.searchField,n("next",()=>ve(e),[A(e,"next")]),n("prev",()=>Me(e),[A(e,"previous")]),n("select",()=>zo(e),[A(e,"all")]),m("label",null,[this.caseField,A(e,"match case")]),m("label",null,[this.reField,A(e,"regexp")]),m("label",null,[this.wordField,A(e,"by word")]),...e.state.readOnly?[]:[m("br"),this.replaceField,n("replace",()=>kt(e),[A(e,"replace")]),n("replaceAll",()=>Ko(e),[A(e,"replace all")])],m("button",{name:"close",onclick:()=>Ln(e),"aria-label":A(e,"close"),type:"button"},["×"])])}commit(){let e=new Sn({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:oe.of(e)}))}keydown(e){Un(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Me:ve)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),kt(this.view))}update(e){for(let r of e.transactions)for(let n of r.effects)n.is(oe)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Y).top}}function A(t,e){return t.state.phrase(e)}const me=30,ge=/[\s\.,:;?!]/;function lt(t,{from:e,to:r}){let n=t.state.doc.lineAt(e),o=t.state.doc.lineAt(r).to,i=Math.max(n.from,e-me),s=Math.min(o,r+me),l=t.state.sliceDoc(i,s);if(i!=n.from){for(let a=0;a<me;a++)if(!ge.test(l[a+1])&&ge.test(l[a])){l=l.slice(a);break}}if(s!=o){for(let a=l.length-1;a>l.length-me;a--)if(!ge.test(l[a-1])&&ge.test(l[a])){l=l.slice(0,a);break}}return p.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${n.number}.`)}const Qo=p.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),jo=[W,Hn.low($o),Qo];class Yo{constructor(e,r,n){this.from=e,this.to=r,this.diagnostic=n}}class q{constructor(e,r,n){this.diagnostics=e,this.panel=r,this.selected=n}static init(e,r,n){let o=e,i=n.facet(En).markerFilter;i&&(o=i(o));let s=y.set(o.map(l=>l.from==l.to||l.from==l.to-1&&n.doc.lineAt(l.from).to==l.from?y.widget({widget:new si(l),diagnostic:l}).range(l.from):y.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity+(l.markClass?" "+l.markClass:"")},diagnostic:l}).range(l.from,l.to)),!0);return new q(s,r,Q(s))}}function Q(t,e=null,r=0){let n=null;return t.between(r,1e9,(o,i,{spec:s})=>{if(!(e&&s.diagnostic!=e))return n=new Yo(o,i,s.diagnostic),!1}),n}function Xo(t,e){let r=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(n=>n.is(Dn))||t.changes.touchesRange(r.from,r.to))}function Zo(t,e){return t.field(v,!1)?e:e.concat(R.appendConfig.of(ci))}const Dn=R.define(),at=R.define(),Bn=R.define(),v=De.define({create(){return new q(y.none,null,null)},update(t,e){if(e.docChanged){let r=t.diagnostics.map(e.changes),n=null;if(t.selected){let o=e.changes.mapPos(t.selected.from,1);n=Q(r,t.selected.diagnostic,o)||Q(r,null,o)}t=new q(r,t.panel,n)}for(let r of e.effects)r.is(Dn)?t=q.init(r.value,t.panel,e.state):r.is(at)?t=new q(t.diagnostics,r.value?Ie.open:null,t.selected):r.is(Bn)&&(t=new q(t.diagnostics,t.panel,r.value));return t},provide:t=>[et.from(t,e=>e.panel),p.decorations.from(t,e=>e.diagnostics)]}),ei=y.mark({class:"cm-lintRange cm-lintRange-active"});function ti(t,e,r){let{diagnostics:n}=t.state.field(v),o=[],i=2e8,s=0;n.between(e-(r<0?1:0),e+(r>0?1:0),(a,c,{spec:h})=>{e>=a&&e<=c&&(a==c||(e>a||r>0)&&(e<c||r<0))&&(o.push(h.diagnostic),i=Math.min(a,i),s=Math.max(c,s))});let l=t.state.facet(En).tooltipFilter;return l&&(o=l(o)),o.length?{pos:i,end:s,above:t.state.doc.lineAt(i).to<s,create(){return{dom:ni(t,o)}}}:null}function ni(t,e){return m("ul",{class:"cm-tooltip-lint"},e.map(r=>Tn(t,r,!1)))}const ri=t=>{let e=t.state.field(v,!1);(!e||!e.panel)&&t.dispatch({effects:Zo(t.state,[at.of(!0)])});let r=ne(t,Ie.open);return r&&r.dom.querySelector(".cm-panel-lint ul").focus(),!0},bt=t=>{let e=t.state.field(v,!1);return!e||!e.panel?!1:(t.dispatch({effects:at.of(!1)}),!0)},oi=t=>{let e=t.state.field(v,!1);if(!e)return!1;let r=t.state.selection.main,n=e.diagnostics.iter(r.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==r.from&&n.to==r.to)?!1:(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},ii=[{key:"Mod-Shift-m",run:ri,preventDefault:!0},{key:"F8",run:oi}],En=ie.define({combine(t){return Object.assign({sources:t.map(e=>e.source)},Le(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,r)=>e?r?n=>e(n)||r(n):e:r}))}});function Rn(t){let e=[];if(t)e:for(let{name:r}of t){for(let n=0;n<r.length;n++){let o=r[n];if(/[a-zA-Z]/.test(o)&&!e.some(i=>i.toLowerCase()==o.toLowerCase())){e.push(o);continue e}}e.push("")}return e}function Tn(t,e,r){var n;let o=r?Rn(e.actions):[];return m("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},m("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(n=e.actions)===null||n===void 0?void 0:n.map((i,s)=>{let l=!1,a=g=>{if(g.preventDefault(),l)return;l=!0;let x=Q(t.state.field(v).diagnostics,e);x&&i.apply(t,x.from,x.to)},{name:c}=i,h=o[s]?c.indexOf(o[s]):-1,f=h<0?c:[c.slice(0,h),m("u",c.slice(h,h+1)),c.slice(h+1)];return m("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${c}${h<0?"":` (access key "${o[s]})"`}.`},f)}),e.source&&m("div",{class:"cm-diagnosticSource"},e.source))}class si extends zn{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return m("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class St{constructor(e,r){this.diagnostic=r,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Tn(e,r,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Ie{constructor(e){this.view=e,this.items=[];let r=o=>{if(o.keyCode==27)bt(this.view),this.view.focus();else if(o.keyCode==38||o.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(o.keyCode==40||o.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(o.keyCode==36)this.moveSelection(0);else if(o.keyCode==35)this.moveSelection(this.items.length-1);else if(o.keyCode==13)this.view.focus();else if(o.keyCode>=65&&o.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:i}=this.items[this.selectedIndex],s=Rn(i.actions);for(let l=0;l<s.length;l++)if(s[l].toUpperCase().charCodeAt(0)==o.keyCode){let a=Q(this.view.state.field(v).diagnostics,i);a&&i.actions[l].apply(e,a.from,a.to)}}else return;o.preventDefault()},n=o=>{for(let i=0;i<this.items.length;i++)this.items[i].dom.contains(o.target)&&this.moveSelection(i)};this.list=m("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:r,onclick:n}),this.dom=m("div",{class:"cm-panel-lint"},this.list,m("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>bt(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(v).selected;if(!e)return-1;for(let r=0;r<this.items.length;r++)if(this.items[r].diagnostic==e.diagnostic)return r;return-1}update(){let{diagnostics:e,selected:r}=this.view.state.field(v),n=0,o=!1,i=null;for(e.between(0,this.view.state.doc.length,(s,l,{spec:a})=>{let c=-1,h;for(let f=n;f<this.items.length;f++)if(this.items[f].diagnostic==a.diagnostic){c=f;break}c<0?(h=new St(this.view,a.diagnostic),this.items.splice(n,0,h),o=!0):(h=this.items[c],c>n&&(this.items.splice(n,c-n),o=!0)),r&&h.diagnostic==r.diagnostic?h.dom.hasAttribute("aria-selected")||(h.dom.setAttribute("aria-selected","true"),i=h):h.dom.hasAttribute("aria-selected")&&h.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)o=!0,this.items.pop();this.items.length==0&&(this.items.push(new St(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),o=!0),i?(this.list.setAttribute("aria-activedescendant",i.id),this.view.requestMeasure({key:this,read:()=>({sel:i.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:s,panel:l})=>{let a=l.height/this.list.offsetHeight;s.top<l.top?this.list.scrollTop-=(l.top-s.top)/a:s.bottom>l.bottom&&(this.list.scrollTop+=(s.bottom-l.bottom)/a)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),o&&this.sync()}sync(){let e=this.list.firstChild;function r(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)r();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)r()}moveSelection(e){if(this.selectedIndex<0)return;let r=this.view.state.field(v),n=Q(r.diagnostics,this.items[e].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Bn.of(n)})}static open(e){return new Ie(e)}}function li(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function pe(t){return li(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const ai=p.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:pe("#d11")},".cm-lintRange-warning":{backgroundImage:pe("orange")},".cm-lintRange-info":{backgroundImage:pe("#999")},".cm-lintRange-hint":{backgroundImage:pe("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),ci=[v,p.decorations.compute([v],t=>{let{selected:e,panel:r}=t.field(v);return!e||!r||e.from==e.to?y.none:y.set([ei.range(e.from,e.to)])}),$n(ti,{hideOn:Xo}),ai];var Ct=function(e){e===void 0&&(e={});var{crosshairCursor:r=!1}=e,n=[];e.closeBracketsKeymap!==!1&&(n=n.concat(cr)),e.defaultKeymap!==!1&&(n=n.concat(Co)),e.searchKeymap!==!1&&(n=n.concat(Jo)),e.historyKeymap!==!1&&(n=n.concat(wr)),e.foldKeymap!==!1&&(n=n.concat(Gn)),e.completionKeymap!==!1&&(n=n.concat(hr)),e.lintKeymap!==!1&&(n=n.concat(ii));var o=[];return e.lineNumbers!==!1&&o.push(Kn()),e.highlightActiveLineGutter!==!1&&o.push(Jn()),e.highlightSpecialChars!==!1&&o.push(_n()),e.history!==!1&&o.push(Ar()),e.foldGutter!==!1&&o.push(Qn()),e.drawSelection!==!1&&o.push(jn()),e.dropCursor!==!1&&o.push(Yn()),e.allowMultipleSelections!==!1&&o.push(re.allowMultipleSelections.of(!0)),e.indentOnInput!==!1&&o.push(Xn()),e.syntaxHighlighting!==!1&&o.push(Ot(Zn,{fallback:!0})),e.bracketMatching!==!1&&o.push(er()),e.closeBrackets!==!1&&o.push(fr()),e.autocompletion!==!1&&o.push(ur()),e.rectangularSelection!==!1&&o.push(tr()),r!==!1&&o.push(nr()),e.highlightActiveLine!==!1&&o.push(rr()),e.highlightSelectionMatches!==!1&&o.push(Bo()),e.tabSize&&typeof e.tabSize=="number"&&o.push(wt.of(" ".repeat(e.tabSize))),o.concat([Pt.of(n.flat())]).filter(Boolean)};const hi="#e5c07b",At="#e06c75",fi="#56b6c2",ui="#ffffff",ye="#abb2bf",je="#7d8799",di="#61afef",mi="#98c379",vt="#d19a66",gi="#c678dd",pi="#21252b",Mt="#2c313a",Lt="#282c34",Ve="#353a42",yi="#3E4451",Dt="#528bff",xi=p.theme({"&":{color:ye,backgroundColor:Lt},".cm-content":{caretColor:Dt},".cm-cursor, .cm-dropCursor":{borderLeftColor:Dt},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:yi},".cm-panels":{backgroundColor:pi,color:ye},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Lt,color:je,border:"none"},".cm-activeLineGutter":{backgroundColor:Mt},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Ve},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Ve,borderBottomColor:Ve},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:Mt,color:ye}}},{dark:!0}),ki=or.define([{tag:u.keyword,color:gi},{tag:[u.name,u.deleted,u.character,u.propertyName,u.macroName],color:At},{tag:[u.function(u.variableName),u.labelName],color:di},{tag:[u.color,u.constant(u.name),u.standard(u.name)],color:vt},{tag:[u.definition(u.name),u.separator],color:ye},{tag:[u.typeName,u.className,u.number,u.changed,u.annotation,u.modifier,u.self,u.namespace],color:hi},{tag:[u.operator,u.operatorKeyword,u.url,u.escape,u.regexp,u.link,u.special(u.string)],color:fi},{tag:[u.meta,u.comment],color:je},{tag:u.strong,fontWeight:"bold"},{tag:u.emphasis,fontStyle:"italic"},{tag:u.strikethrough,textDecoration:"line-through"},{tag:u.link,color:je,textDecoration:"underline"},{tag:u.heading,fontWeight:"bold",color:At},{tag:[u.atom,u.bool,u.special(u.variableName)],color:vt},{tag:[u.processingInstruction,u.string,u.inserted],color:mi},{tag:u.invalid,color:ui}]),bi=[xi,Ot(ki)];var Si=p.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),Ci=function(e){e===void 0&&(e={});var{indentWithTab:r=!0,editable:n=!0,readOnly:o=!1,theme:i="light",placeholder:s="",basicSetup:l=!0}=e,a=[];switch(r&&a.unshift(Pt.of([Ao])),l&&(typeof l=="boolean"?a.unshift(Ct()):a.unshift(Ct(l))),s&&a.unshift(ir(s)),i){case"light":a.push(Si);break;case"dark":a.push(bi);break;case"none":break;default:a.push(i);break}return n===!1&&a.push(p.editable.of(!1)),o&&a.push(re.readOnly.of(!0)),[...a]},Ai=t=>({line:t.state.doc.lineAt(t.state.selection.main.from),lineCount:t.state.doc.lines,lineBreak:t.state.lineBreak,length:t.state.doc.length,readOnly:t.state.readOnly,tabSize:t.state.tabSize,selection:t.state.selection,selectionAsSingle:t.state.selection.asSingle().main,ranges:t.state.selection.ranges,selectionCode:t.state.sliceDoc(t.state.selection.main.from,t.state.selection.main.to),selections:t.state.selection.ranges.map(e=>t.state.sliceDoc(e.from,e.to)),selectedText:t.state.selection.ranges.some(e=>!e.empty)}),Bt=Xe.define(),vi=[];function Mi(t){var{value:e,selection:r,onChange:n,onStatistics:o,onCreateEditor:i,onUpdate:s,extensions:l=vi,autoFocus:a,theme:c="light",height:h=null,minHeight:f=null,maxHeight:g=null,width:x=null,minWidth:C=null,maxWidth:N=null,placeholder:P="",editable:le=!0,readOnly:ae=!1,indentWithTab:ce=!0,basicSetup:he=!0,root:Oe,initialState:X}=t,[H,fe]=M.useState(),[k,O]=M.useState(),[V,U]=M.useState(),Pe=p.theme({"&":{height:h,minHeight:f,maxHeight:g,width:x,minWidth:C,maxWidth:N},"& .cm-scroller":{height:"100% !important"}}),We=p.updateListener.of(E=>{if(E.docChanged&&typeof n=="function"&&!E.transactions.some(In=>In.annotation(Bt))){var ee=E.state.doc,ue=ee.toString();n(ue,E)}o&&o(Ai(E))}),wn=Ci({theme:c,editable:le,readOnly:ae,placeholder:P,indentWithTab:ce,basicSetup:he}),Z=[We,Pe,...wn];return s&&typeof s=="function"&&Z.push(p.updateListener.of(s)),Z=Z.concat(l),M.useEffect(()=>{if(H&&!V){var E={doc:e,selection:r,extensions:Z},ee=X?re.fromJSON(X.json,E,X.fields):re.create(E);if(U(ee),!k){var ue=new p({state:ee,parent:H,root:Oe});O(ue),i&&i(ue,ee)}}return()=>{k&&(U(void 0),O(void 0))}},[H,V]),M.useEffect(()=>fe(t.container),[t.container]),M.useEffect(()=>()=>{k&&(k.destroy(),O(void 0))},[k]),M.useEffect(()=>{a&&k&&k.focus()},[a,k]),M.useEffect(()=>{k&&k.dispatch({effects:R.reconfigure.of(Z)})},[c,l,h,f,g,x,C,N,P,le,ae,ce,he,n,s]),M.useEffect(()=>{if(e!==void 0){var E=k?k.state.doc.toString():"";k&&e!==E&&k.dispatch({changes:{from:0,to:E.length,insert:e||""},annotations:[Bt.of(!0)]})}},[e,k]),{state:V,setState:U,view:k,setView:O,container:H,setContainer:fe}}var Li=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],Di=M.forwardRef((t,e)=>{var{className:r,value:n="",selection:o,extensions:i=[],onChange:s,onStatistics:l,onCreateEditor:a,onUpdate:c,autoFocus:h,theme:f="light",height:g,minHeight:x,maxHeight:C,width:N,minWidth:P,maxWidth:le,basicSetup:ae,placeholder:ce,indentWithTab:he,editable:Oe,readOnly:X,root:H,initialState:fe}=t,k=sr(t,Li),O=M.useRef(null),{state:V,view:U,container:Pe}=Mi({container:O.current,root:H,value:n,autoFocus:h,theme:f,height:g,minHeight:x,maxHeight:C,width:N,minWidth:P,maxWidth:le,basicSetup:ae,placeholder:ce,indentWithTab:he,editable:Oe,readOnly:X,selection:o,onChange:s,onStatistics:l,onCreateEditor:a,onUpdate:c,extensions:i,initialState:fe});if(M.useImperativeHandle(e,()=>({editor:O.current,state:V,view:U}),[O,Pe,V,U]),typeof n!="string")throw new Error("value must be typeof string but got "+typeof n);var We=typeof f=="string"?"cm-theme-"+f:"cm-theme";return lr.jsx("div",ar({ref:O,className:""+We+(r?" "+r:"")},k))});Di.displayName="CodeMirror";export{Di as R,Ar as a,wr as b,Co as d,Bo as h};

import{B as V,G as D,H as o,Q as Be,$ as ye,J as t,U as Qe,X as qe,Y as ge,Z as We,_ as Ye,a0 as Ve,a1 as ze,a2 as Se,a3 as ee,a4 as He,a5 as Ue,a6 as Ge,a7 as Ke,K as Xe,a8 as Je,a9 as Ze,aa as et,ab as tt,ac as nt,ad as st,ae as at,af as Q,ag as rt,ah as q,ai as K,aj as xe,ak as ot,al as it,am as ct,an as lt,ao as ut,ap as dt,aq as se,ar as mt,as as ve,at as pt,au as ae,av as ht,aw as ft,ax as yt,ay as re,az as gt,aA as St,aB as xt,aC as vt,aD as It,aE as bt,aF as W,aG as X,aH as Y,aI as jt,aJ as Tt,aK as Ie,aL as Lt,aM as be,aN as _t,aO as Rt,aP as Et,aQ as je,aR as wt,aS as Pt}from"./sanity-9d7a2574.js";import{useDeskToolSetting as oe}from"./index-9c45d2a0-f9be8bea.js";import{P as Ct}from"./PaneItem-a516bd14-28cbd754.js";import"./json-inspector-2d4d52f9.js";const ie=100,J=2e3,Te={by:[{field:"_updatedAt",direction:"desc"}]},At={};function Mt(s){return vt(s).map(e=>({...e.draft||e.published,hasPublished:!!e.published,hasDraft:!!e.draft}))}const Ot=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function Le(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=s.match(Ot);if(!a)return null;const n=(a[1]||a[2]).trim().replace(/^["']|["']$/g,"");if(n[0]==="$"){const r=n.slice(1),d=e[r];return typeof d=="string"?d:null}return n}function Ft(s){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(s.trim())}function Dt(s,e){const a=s.by.map(n=>{if(n.mapWith)return n;const r=Nt(e,n.field);return r?kt(r,"datetime")?{...n,mapWith:"dateTime"}:r.jsonType==="string"?{...n,mapWith:"lower"}:n:n});return a.every((n,r)=>n===s.by[r])?s:{...s,by:a}}function Nt(s,e){const a=Ze(e);let n=s;for(const r of a){if(!n)return;if(typeof r=="string"){n=$t(n,r);continue}if(!(et(r)||tt(r))||n.jsonType!=="array")return;const[i,c]=n.of||[];if(c||!i)return;if(!nt(i)){n=i;continue}const[l,m]=i.to||[];if(m||!l)return;n=l}return n}function $t(s,e){if(!("fields"in s))return;const a=s.fields.find(n=>n.name===e);return a?a.type:void 0}function kt(s,e){let a=s.type;for(;a;){if(a.name===e||!a.type&&a.jsonType===e)return!0;a=a.type}return!1}var ce=Object.freeze,Bt=Object.defineProperty,_e=(s,e)=>ce(Bt(s,"raw",{value:ce(e||s.slice())})),le,ue;const Qt=V(D)(le||(le=_e([`
  position: relative;
`]))),qt=V(D)(ue||(ue=_e([`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
`]))),Wt=[...Array(30).keys()];function Yt(s){const{layout:e}=s;return t.jsx(xe,{padding:2,space:1,children:Wt.map(a=>t.jsx(Se,{padding:2,children:t.jsx(It,{isPlaceholder:!0,layout:e})},a))})}function Vt(s){const{childItemId:e,error:a,filterIsSimpleTypeConstraint:n,hasMaxItems:r,hasSearchQuery:d,isActive:i,isLazyLoading:c,isLoading:l,items:m,layout:v,loadingVariant:y,onListChange:I,onRetry:g,paneTitle:u,searchInputElement:b,showIcons:j}=s,E=ee(),{collapsed:L}=st(),{collapsed:p,index:_}=ye(),[T,S]=o.useState(!1),C=o.useCallback(()=>{l||c||!T||I()},[c,l,I,T]);o.useEffect(()=>{if(p)return;const x=setTimeout(()=>{S(!0)},0);return()=>{clearTimeout(x)}},[p,m]);const A=o.useCallback((x,h)=>{let{activeIndex:P}=h;const M=at(x._id),O=e===M,f=!i&&O,R=i&&O,F=P===m.length-1,z=F&&c,H=F&&r;return t.jsxs(t.Fragment,{children:[t.jsx(Ct,{icon:j===!1?!1:void 0,id:M,layout:v,marginBottom:1,pressed:f,schemaType:E.get(x._type),selected:R,value:x}),z&&t.jsx(Q,{align:"center",justify:"center",padding:4,children:t.jsx(rt,{muted:!0})}),H&&t.jsx(D,{marginY:1,paddingX:3,paddingY:4,children:t.jsxs(q,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",J," documents"]})})]})},[e,i,m.length,v,E,j,r,c]),N=o.useMemo(()=>d?t.jsx(Q,{align:"center",direction:"column",height:"fill",justify:"center",children:t.jsx(K,{width:1,children:t.jsx(D,{paddingX:4,paddingY:5,children:t.jsx(q,{align:"center",muted:!0,children:"No results found"})})})}):t.jsx(Q,{align:"center",direction:"column",height:"fill",justify:"center",children:t.jsx(K,{width:1,children:t.jsx(D,{paddingX:4,paddingY:5,children:t.jsx(q,{align:"center",muted:!0,children:n?"No documents of this type":"No matching documents"})})})}),[n,d]),w=o.useMemo(()=>{if(!T)return null;if(a)return t.jsx(Q,{align:"center",direction:"column",height:"fill",justify:"center",children:t.jsx(K,{width:1,children:t.jsxs(xe,{paddingX:4,paddingY:5,space:4,children:[t.jsx(ot,{as:"h3",children:"Could not fetch list items"}),t.jsxs(q,{as:"p",children:["Error: ",t.jsx("code",{children:a.message})]}),g&&t.jsx(D,{children:t.jsx(ge,{icon:it,onClick:g,text:"Retry",tone:"primary"})})]})})});if(!l&&m.length===0)return N;if(y==="initial"&&l)return t.jsx(ct,{ms:300,children:t.jsx(Yt,{layout:v})});if(y==="spinner"&&l)return null;const x="".concat(_,"-").concat(p);return t.jsx(Qt,{overflow:"hidden",height:"fill",children:t.jsx(qt,{children:t.jsx(lt,{activeItemDataAttr:"data-hovered",ariaLabel:u,canReceiveFocus:!0,focusRingOffset:-3,inputElement:b,itemHeight:51,items:m,onEndReached:C,onlyShowSelectionWhenActive:!0,overscan:10,padding:2,paddingBottom:1,renderItem:A,wrapAround:!1},x)})})},[p,a,C,_,l,m,v,y,g,A,b,T]);return t.jsx(ut,{overflow:L||y==="initial"?"hidden":"auto",children:w})}const Re=o.memo(s=>{let{contentAfter:e,index:a,initialValueTemplates:n=[],menuItemGroups:r=[],menuItems:d=[],setLayout:i,setSortOrder:c,title:l}=s;const{features:m}=Be(),{collapsed:v,isLast:y}=ye(),I=y&&!v?-1:0,g=o.useMemo(()=>({setLayout:u=>{let{layout:b}=u;i(b)},setSortOrder:u=>{c(u)}}),[i,c]);return t.jsx(Qe,{actions:t.jsx(qe,{initialValueTemplateItems:n,actionHandlers:g,menuItemGroups:r,menuItems:d}),backButton:m.backButton&&a>0&&t.jsx(ge,{as:We,"data-as":"a",icon:Ye,mode:"bleed"}),contentAfter:e,tabIndex:I,title:l})});Re.displayName="DocumentListPaneHeader";function zt(s){const{client:e,schema:a,sort:n,limit:r,params:d,filter:i,searchQuery:c,staticTypeNames:l}=s,m=n.by,v=n==null?void 0:n.extendedProjection,y=bt(()=>e.listen("*[".concat(i,"]"),d,{events:["welcome","mutation","reconnect"],includeResult:!1,visibility:"query"})).pipe(W((u,b)=>b===0&&u.type!=="welcome"?X(()=>new Error(u.type==="reconnect"?"Could not establish EventSource connection":'Received unexpected type of first event "'.concat(u.type,'"'))):Y(u)),jt()),[I,g]=Tt(y,u=>u.type==="welcome");return Ie(I.pipe(be(1)),g.pipe(Lt(1e3,wt,{leading:!0,trailing:!0}))).pipe(_t(u=>(l?Y(l):e.observable.fetch("array::unique(*[".concat(i,"][]._type)"),d)).pipe(W(j=>{const E=j.flatMap(C=>a.get(C)||[]),L={filter:i,query:c||"",types:E},p={__unstable_extendedProjection:v,comments:["findability-source: ".concat(c?"list-query":"list")],limit:r,params:d,sort:m},{query:_,params:T}=Pt(L,p),S=()=>e.observable.fetch(_,T);return u.type==="mutation"&&u.visibility!=="query"?je(1200).pipe(W(S)):S()}))))}const Ht=[],de={error:null,onRetry:void 0,result:null},Ut={result:null,error:null};function Gt(s){const{filter:e,params:a,sortOrder:n,searchQuery:r,apiVersion:d}=s,i=dt({...se,apiVersion:d||se.apiVersion}),c=ee(),[l,m]=o.useState(de),{onRetry:v,error:y,result:I}=l,g=I==null?void 0:I.documents,u=o.useMemo(()=>g?Mt(g):Ht,[g]),[b,j]=o.useState(!1),[E,L]=o.useState(!1),[p,_]=o.useState(!1),T=o.useMemo(()=>Le(e,a),[e,a]),S=I===null&&!y,C=(g==null?void 0:g.length)===J,A=o.useCallback(()=>{S||E||p||_(!0)},[S,E,p]),N=o.useCallback(h=>{var P,M;if(h.error){m(h);return}const O=((M=(P=h.result)==null?void 0:P.documents)==null?void 0:M.length)||0;if(!h.error&&(h==null?void 0:h.result)===null&&p){j(!0);return}if(O<ie&&O!==0&&!p&&L(!0),(h==null?void 0:h.result)===null){m(R=>({...R.error?h:R}));return}j(!1),m(h)},[p]),w=o.useMemo(()=>{const h=new mt,P=()=>h.next();return zt({client:i,filter:e,limit:p?J:ie,params:a,schema:c,searchQuery:r||"",sort:n||Te,staticTypeNames:T?[T]:void 0}).pipe(ve(f=>({result:{documents:f},error:null})),pt(Ut),ae(f=>f instanceof ProgressEvent?X(()=>new Error("Request error")):X(()=>f)),ae((f,R)=>Rt(Y({result:null,error:f}),Ie(Et(window,"online"),h).pipe(be(1),W(()=>R)))),ht((f,R)=>({...f,...R,onRetry:P})))},[i,e,a,c,r,p,n,T]);o.useEffect(()=>{const h=w.subscribe(N);return()=>{h.unsubscribe()}},[N,w]);const x=o.useCallback(()=>{L(!1),j(!1),m(de),_(!1)},[]);return o.useEffect(()=>{x()},[x,e,a,n,r]),{error:y,hasMaxItems:C,isLazyLoading:b,isLoading:S,isSearchReady:!y,items:u,onListChange:A,onRetry:v}}var me=Object.freeze,Kt=Object.defineProperty,te=(s,e)=>me(Kt(s,"raw",{value:me(e||s.slice())})),pe,he,fe;const Z=[],Xt=Ve(pe||(pe=te([`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`]))),Jt=V(ze)(he||(he=te([`
  animation: `,` 500ms linear infinite;
`])),Xt),Zt=V(Se)(fe||(fe=te([`
  [data-ui='TextInput'] {
    border-radius: inherit;
  }
`])));function en(s){const e=o.useRef(s);return ft(e.current,s)||(e.current=s),e.current}const tn=s=>{const{menuItems:e,sortOrderRaw:a,layout:n}=s;return e==null?void 0:e.map(r=>{var d,i,c,l;return(d=r.params)!=null&&d.layout?{...r,selected:n===((i=r.params)==null?void 0:i.layout)}:(c=r==null?void 0:r.params)!=null&&c.by?{...r,selected:yt(a==null?void 0:a.by,((l=r==null?void 0:r.params)==null?void 0:l.by)||Z)}:{...r,selected:!1}})},on=o.memo(function(e){const{childItemId:a,index:n,isActive:r,isSelected:d,pane:i,paneKey:c}=e,l=ee(),{name:m}=He(),{defaultLayout:v="default",displayOptions:y,initialValueTemplates:I=Z,menuItemGroups:g,menuItems:u,options:b,title:j}=i,{apiVersion:E,defaultOrdering:L=Z,filter:p}=b,_=en(b.params||At),T=i.source,S=o.useMemo(()=>Le(p,_),[p,_]),C=(y==null?void 0:y.showIcons)!==!1,[A,N]=oe(S,"layout",v),[w,x]=o.useState(""),[h,P]=o.useState(""),[M,O]=o.useState(null),f=o.useRef(!1),R=o.useMemo(()=>(L==null?void 0:L.length)>0?{by:L}:Te,[L]),[F,z]=oe(S,"sortOrder",R),H=S&&F?Dt(F,l.get(S)):F,Ee=Ue(H),we=Ft(p),{error:Pe,hasMaxItems:Ce,isLazyLoading:Ae,isLoading:$,isSearchReady:Me,items:U,onListChange:Oe,onRetry:Fe}=Gt({apiVersion:E,filter:p,params:_,searchQuery:w==null?void 0:w.trim(),sortOrder:Ee}),De=o.useMemo(()=>tn({menuItems:u,sortOrderRaw:F,layout:A}),[A,u,F]),Ne=Ge(B=>B.pipe(ve(G=>G.target.value),re(P),gt(G=>G===""?Y(""):je(300)),re(x)),[]),k=o.useCallback(()=>{x(""),P("")},[]),$e=o.useCallback(B=>{B.key==="Escape"&&k()},[k]);o.useEffect(()=>(f.current===!1&&!$&&(f.current=!0),()=>{f.current=!1}),[$]),o.useEffect(()=>{k(),f.current=!1},[c,k]);const ne=o.useMemo(()=>$&&U.length===0&&f.current?"spinner":"initial",[$,U.length]),ke=t.jsx(D,{paddingX:2,paddingBottom:2,children:t.jsx(Zt,{radius:4,tone:"transparent",children:t.jsx(St,{"aria-label":"Search list",autoComplete:"off",border:!1,clearButton:!!w,disabled:!Me,fontSize:[2,2,1],icon:ne==="spinner"?Jt:xt,onChange:Ne,onClear:k,onKeyDown:$e,placeholder:"Search list",radius:2,ref:O,spellCheck:!1,value:h})})});return t.jsx(Ke,{name:T||m,children:t.jsxs(Xe,{currentMaxWidth:350,"data-ui":"DocumentListPane",id:c,maxWidth:640,minWidth:320,selected:d,children:[Je,t.jsx(Re,{contentAfter:ke,index:n,initialValueTemplates:I,menuItemGroups:g,menuItems:De,setLayout:N,setSortOrder:z,title:j}),t.jsx(Vt,{childItemId:a,error:Pe,filterIsSimpleTypeConstraint:we,hasMaxItems:Ce,hasSearchQuery:!!w,isActive:r,isLazyLoading:Ae,isLoading:$,items:U,layout:A,loadingVariant:ne,onListChange:Oe,onRetry:Fe,paneTitle:j,searchInputElement:M,showIcons:C},c)]})})});export{on as default};
